{% extends "base.html" %}

{% block content %}
<div class="govuk-grid-row">
  <form action="{{url('evaluation-create', status)}}" method="post">
    {{csrf_input}}
    <input type="hidden" id="status" name="status" value="{{status}}" />

    <h2 class="govuk-heading-l">
      About the evaluation
    </h2>

    {% if errors %}
      <div class="govuk-error-summary" data-module="govuk-error-summary">
        <div role="alert">
          <h2 class="govuk-error-summary__title">
            There is a problem
          </h2>
          <div class="govuk-error-summary__body">
            <ul class="govuk-list govuk-error-summary__list">
              {% for field, error_list in errors.items() %}
                {% for error in error_list %}
                  <li>
                    <a href="#{{field}}">{{error.message}}</a>
                  </li>
                {% endfor %}
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    {% endif %}

    <div class="govuk-form-group {% if errors['title'] %}govuk-form-group--error{% endif %}">
      <h3 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--m" for="title">
          Title of evaluation
        </label>
      </h3>
      {% if errors['title'] %}
        <p id="full-name-input-error" class="govuk-error-message">
          {% for error in errors['title'] %}
          <span class="govuk-visually-hidden">Error:</span> {{ error.message }}
          {% endfor %}
        </p>
      {% endif %}
      <div id="title-hint" class="govuk-hint">
        Write this so that your evaluation can be understood by someone who does not know the policy area.
      </div>
      <input
        class="govuk-input"
        id="title"
        name="title"
        type="text"
        aria-describedby="title-hint"
        value="{{ data.title }}"
      >
    </div>

    <div class="govuk-form-group {% if errors['lead_department'] %}govuk-form-group--error{% endif %}">
      <h3 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--m" for="lead_department">
          Lead Department
        </label>
      </h3>
      {% if errors['lead_department'] %}
        <p id="full-name-input-error" class="govuk-error-message">
          {% for error in errors['lead_department'] %}
            <span class="govuk-visually-hidden">Error:</span> {{ error.message }}
          {% endfor %}
        </p>
      {% endif %}
      <div id="event-name-hint" class="govuk-hint">
        Type to search for a department
      </div>
      <select class="govuk-select" id="lead_department" name="lead_department" data-accessible-autocomplete>
        <option value="{{data.lead_department}}"></option>
        {% for department in departments %}
          <option value="{{department.code}}" {% if department.code == data.lead_department %}selected{% endif %}>{{department.display}}</option>
        {% endfor %}
      </select>
    </div>


    <div class="govuk-form-group {% if errors['departments'] %}govuk-form-group--error{% endif %}">
      <h3 class="govuk-label-wrapper">
        <label class="govuk-label govuk-label--m" for="departments">
          Other Departments involved
        </label>
      </h3>
      {% if errors['departments'] %}
        <p id="full-name-input-error" class="govuk-error-message">
          {% for error in errors['departments'] %}
            <span class="govuk-visually-hidden">Error:</span> {{ error.message }}
          {% endfor %}
        </p>
      {% endif %}
      <div id="event-name-hint" class="govuk-hint">
        Type to search for a department
      </div>
      <select class="govuk-select" id="departments" name="departments" data-accessible-autocomplete>
        <option></option>
        {% for department in departments %}
          <option value="{{department.code}}">{{department.display}}</option>
        {% endfor %}
      </select>
    </div>

    <button
      class="govuk-button govuk-button--secondary"
      data-module="govuk-button"
      formaction="{{url('evaluation-create', status)}}"
      name="addanother"
      value="departments"
    >
      Add another non-lead department
    </button>

    {% if data.departments %}
      <dl class="govuk-summary-list">
        {% for department in data.departments %}
          <input type="hidden" id="department-{{ loop.index }}" name="departments" value="{{department.code}}" />
          <div class="govuk-summary-list__row">
            <dt class="govuk-summary-list__value">
              {{department.display}}
            </dt>
            <dd class="govuk-summary-list__value">
              <button
                class="govuk-button govuk-button--secondary"
                data-module="govuk-button"
                name="remove_department"
                value="{{department.code}}"
              >
                Remove
              </button>
            </dd>
          </div>
        {% endfor %}
      </dl>
    {% endif %}

    <br>

    <button
      data-prevent-double-click="true"
      class="govuk-button"
      data-module="govuk-button"
      name="form_complete"
      value="completed"
    >
      Save and continue
    </button>

  </form>
</div>
{% endblock %}
