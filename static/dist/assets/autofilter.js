window.GOVUK=window.GOVUK||{};window.GOVUK.Modules=window.GOVUK.Modules||{};(function(s){function n(i){this.$optionSelect=i,this.$options=this.$optionSelect.querySelectorAll("input[type='checkbox']"),this.$optionsContainer=this.$optionSelect.querySelector(".autofilter-option-select__container"),this.$optionList=this.$optionsContainer.querySelector(".js-auto-height-inner"),this.$allCheckboxes=this.$optionsContainer.querySelectorAll(".govuk-checkboxes__item"),this.hasFilter=this.$optionSelect.getAttribute("data-filter-element")||"",this.checkedCheckboxes=[]}n.prototype.init=function(){if(this.hasFilter.length){var i=document.createElement("div");i.innerHTML=this.hasFilter;var e=i.cloneNode(!0);e.classList.add("autofilter-option-select__filter"),this.$optionsContainer.parentNode.insertBefore(e,this.$optionsContainer),this.$filter=this.$optionSelect.querySelector('input[name="option-select-filter"]'),this.$filterCount=document.getElementById(this.$filter.getAttribute("aria-describedby")),this.filterTextSingle=" "+this.$filterCount.getAttribute("data-single"),this.filterTextMultiple=" "+this.$filterCount.getAttribute("data-multiple"),this.filterTextSelected=" "+this.$filterCount.getAttribute("data-selected"),this.checkboxLabels=[],this.filterTimeout=0,this.getAllCheckedCheckboxes();for(var t=0;t<this.$allCheckboxes.length;t++)this.checkboxLabels.push(this.cleanString(this.$allCheckboxes[t].textContent));this.$filter.addEventListener("keyup",this.typeFilterText.bind(this))}this.$optionsContainer.querySelector(".autofilter-checkboxes__list").addEventListener("change",this.updateCheckedCount.bind(this));var l=this.checkedString();l&&this.attachCheckedCounter(l)},n.prototype.typeFilterText=function(i){i.stopPropagation();var e=13;i.keyCode!==e?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout((function(){this.doFilter(this)}).bind(this),300)):i.preventDefault()},n.prototype.cleanString=function(e){return e=e.replace(/&/g,"and"),e=e.replace(/[’',:–-]/g,""),e=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),e.trim().replace(/\s\s+/g," ").toLowerCase()},n.prototype.getAllCheckedCheckboxes=function(){this.checkedCheckboxes=[];for(var e=0;e<this.$options.length;e++)this.$options[e].checked&&this.checkedCheckboxes.push(e)},n.prototype.doFilter=function(e){var t=e.cleanString(e.$filter.value),l=e.checkedCheckboxes.slice(),o=0;for(o=0;o<e.$allCheckboxes.length;o++)l.indexOf(o)===-1&&e.checkboxLabels[o].search(t)!==-1&&l.push(o);for(o=0;o<e.$allCheckboxes.length;o++)e.$allCheckboxes[o].style.display="none";for(o=0;o<l.length;o++)e.$allCheckboxes[l[o]].style.display="block";var r=e.$optionsContainer.querySelectorAll(".govuk-checkboxes__input:checked").length,c=l.length+r,h=c+(c===1?e.filterTextSingle:e.filterTextMultiple)+", "+r+e.filterTextSelected;e.$filterCount.innerHTML=h},n.prototype.attachCheckedCounter=function(e){var t=document.createElement("div");t.setAttribute("class","autofilter-option-select__selected-counter js-selected-counter"),t.innerHTML=e,this.$optionSelect.querySelector(".autofilter-legend").insertAdjacentElement("afterend",t)},n.prototype.updateCheckedCount=function(){var e=this.checkedString(),t=this.$optionSelect.querySelector(".js-selected-counter");e?t===null?this.attachCheckedCounter(e):t.textContent=e:t&&t.parentNode.removeChild(t)},n.prototype.checkedString=function(){this.getAllCheckedCheckboxes();var e=this.checkedCheckboxes.length,t=!1;return e>0&&(t=e+" selected"),t},s.OptionSelect=n})(window.GOVUK.Modules);var a=new window.GOVUK.Modules.OptionSelect(document.getElementById("autofilter"));a.init();
